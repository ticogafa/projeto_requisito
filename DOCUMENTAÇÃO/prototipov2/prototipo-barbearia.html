<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Barbearia</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        .profile-card { transition: all 0.3s ease; }
        .profile-card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(255, 140, 0, 0.3); }
        .toast { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .status-badge { display: inline-flex; align-items: center; gap: 4px; }
        .star-rating .material-icons { transition: color 0.2s; }
        .star-rating .material-icons:hover { color: #FF8C00; }
        .time-slot { cursor: pointer; transition: all 0.2s; }
        .time-slot:disabled { cursor: not-allowed; opacity: 0.5; }
    </style>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF8C00',
                        dark: { 900: '#0F0F0F', 800: '#1A1A1A', 700: '#252525', 600: '#303030' }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-dark-900 text-gray-100">
    
    <div id="app">
        <div id="profileSelection" class="min-h-screen flex flex-col items-center justify-center p-8">
            <div class="text-center mb-12">
                <div class="flex items-center justify-center gap-3 mb-4"><span class="material-icons text-primary text-6xl">content_cut</span><h1 class="text-5xl font-bold text-primary">Sistema Barbearia</h1></div>
                <p class="text-gray-400 text-xl">Selecione o tipo de acesso para começar</p>
            </div>
            <div class="grid grid-cols-3 gap-8 max-w-6xl w-full">
                <div onclick="selectProfile('admin')" class="profile-card bg-dark-800 rounded-2xl p-8 cursor-pointer border-2 border-dark-600 hover:border-primary"><div class="text-center"><div class="bg-primary/10 w-32 h-32 rounded-full flex items-center justify-center mx-auto mb-6"><span class="material-icons text-primary" style="font-size: 72px;">admin_panel_settings</span></div><h3 class="text-2xl font-semibold mb-2">Administrador</h3><p class="text-gray-400">Gerencie toda a operação da barbearia</p></div></div>
                <div onclick="selectProfile('professional')" class="profile-card bg-dark-800 rounded-2xl p-8 cursor-pointer border-2 border-dark-600 hover:border-primary"><div class="text-center"><div class="bg-primary/10 w-32 h-32 rounded-full flex items-center justify-center mx-auto mb-6"><span class="material-icons text-primary" style="font-size: 72px;">badge</span></div><h3 class="text-2xl font-semibold mb-2">Profissional</h3><p class="text-gray-400">Realize e gerencie seus atendimentos</p></div></div>
                <div onclick="selectProfile('client')" class="profile-card bg-dark-800 rounded-2xl p-8 cursor-pointer border-2 border-dark-600 hover:border-primary"><div class="text-center"><div class="bg-primary/10 w-32 h-32 rounded-full flex items-center justify-center mx-auto mb-6"><span class="material-icons text-primary" style="font-size: 72px;">person</span></div><h3 class="text-2xl font-semibold mb-2">Cliente</h3><p class="text-gray-400">Agende e avalie seus atendimentos</p></div></div>
            </div>
        </div>
        <div id="loginScreen" class="hidden min-h-screen flex items-center justify-center p-8"><div class="bg-dark-800 rounded-2xl p-10 w-full max-w-md border border-dark-600"><div class="text-center mb-8"><span class="material-icons text-primary text-5xl mb-4">content_cut</span><h2 class="text-3xl font-bold mb-2">Sistema Barbearia</h2><p class="text-gray-400" id="loginSubtitle">Entrando como...</p></div><form onsubmit="login(event)" class="space-y-6"><div><label class="block text-sm font-medium mb-2">E-mail ou Usuário</label><input type="text" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-4 py-3 focus:outline-none focus:border-primary" placeholder="Digite seu e-mail"></div><div><label class="block text-sm font-medium mb-2">Senha</label><input type="password" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-4 py-3 focus:outline-none focus:border-primary" placeholder="Digite sua senha"></div><button type="submit" class="w-full bg-primary hover:bg-orange-600 text-white font-semibold py-3 rounded-lg transition">Entrar</button><div class="text-center"><a onclick="showToast('Em breve', 'Funcionalidade de recuperação de senha em desenvolvimento.', 'info'); return false;" href="#" class="text-primary hover:underline text-sm cursor-pointer">Esqueceu sua senha?</a></div><div class="text-center pt-4 border-t border-dark-600"><button type="button" onclick="backToProfileSelection()" class="text-gray-400 hover:text-gray-200 text-sm">← Voltar para seleção de perfil</button></div></form></div></div>

        <div id="adminPanel" class="hidden min-h-screen">
            <header class="bg-dark-800 border-b border-dark-600 px-8 py-4"><div class="flex items-center justify-between"><div class="flex items-center gap-3"><span class="material-icons text-primary text-4xl">content_cut</span><h1 class="text-2xl font-bold">Sistema Barbearia</h1></div><div class="flex items-center gap-6"><div class="flex items-center gap-2 bg-primary/10 px-4 py-2 rounded-lg"><span class="material-icons text-primary">admin_panel_settings</span><span class="font-medium">Administrador</span></div><div class="flex items-center gap-3"><span class="text-sm text-gray-400">Admin Master</span><button onclick="logout()" class="material-icons text-gray-400 hover:text-primary cursor-pointer">logout</button></div></div></div></header>
            <div class="flex">
                <aside class="w-64 bg-dark-800 min-h-screen border-r border-dark-600 p-6">
                    <nav class="space-y-2">
                        <a onclick="return false;" href="#" class="flex items-center gap-3 px-4 py-3 rounded-lg bg-primary/10 text-primary"><span class="material-icons">dashboard</span><span class="font-medium">Dashboard</span></a>
                        <a onclick="openAdminModal('professionalManagement'); return false;" href="#" class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-dark-700 text-gray-400 hover:text-gray-200"><span class="material-icons">people</span><span class="font-medium">Profissionais</span></a>
                        <a onclick="openAdminModal('serviceManagement'); return false;" href="#" class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-dark-700 text-gray-400 hover:text-gray-200"><span class="material-icons">content_cut</span><span class="font-medium">Serviços</span></a>
                        <a onclick="openAdminModal('cashControl'); return false;" href="#" class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-dark-700 text-gray-400 hover:text-gray-200"><span class="material-icons">attach_money</span><span class="font-medium">Financeiro</span></a>
                        <a onclick="showToast('Em breve', 'Esta funcionalidade estará disponível em breve.', 'info', 'info'); return false;" href="#" class="flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-dark-700 text-gray-400 hover:text-gray-200"><span class="material-icons">group</span><span class="font-medium">Clientes</span></a>
                    </nav>
                </aside>
                <main class="flex-1 p-8">
                    <div class="mb-8"><h2 class="text-3xl font-bold mb-2">Painel Administrativo</h2><p class="text-gray-400">Visão geral da operação</p></div>
                    <div class="grid grid-cols-4 gap-4 mb-8">
                        <button onclick="openAdminModal('cashControl')" class="bg-dark-800 border border-dark-600 hover:border-primary rounded-xl p-4 text-left transition group"><span class="material-icons text-green-400 text-3xl mb-2 group-hover:scale-110 transition">account_balance_wallet</span><h4 class="font-semibold mb-1">Controle de Caixa</h4><p class="text-xs text-gray-400">Gerenciar entradas e saídas</p></button>
                        <button onclick="openAdminModal('reports')" class="bg-dark-800 border border-dark-600 hover:border-primary rounded-xl p-4 text-left transition group"><span class="material-icons text-blue-400 text-3xl mb-2 group-hover:scale-110 transition">bar_chart</span><h4 class="font-semibold mb-1">Relatório de Desempenho</h4><p class="text-xs text-gray-400">Métricas por profissional</p></button>
                    </div>
                </main>
            </div>
        </div>

        <div id="cashControlModal" onclick="closeModalOnBackdrop(event, 'cashControlModal')" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
            <div class="bg-dark-800 rounded-2xl p-8 max-w-5xl w-full border border-dark-600 max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
                <div class="flex items-center justify-between mb-6"><div class="flex items-center gap-3"><span class="material-icons text-green-400 text-4xl">account_balance_wallet</span><h3 class="text-2xl font-bold">Controle de Caixa</h3></div><button onclick="closeModal('cashControlModal')" class="material-icons text-gray-400 hover:text-primary cursor-pointer">close</button></div>
                <div class="grid grid-cols-3 gap-6 mb-6">
                    <div class="bg-dark-700 rounded-xl p-4"><p class="text-gray-400 text-sm">Saldo Atual</p><h3 class="text-2xl font-bold mt-1" id="cashBalance">R$ 0,00</h3></div>
                    <div class="bg-dark-700 rounded-xl p-4"><p class="text-gray-400 text-sm">Entradas de Hoje</p><h3 class="text-2xl font-bold mt-1 text-green-500" id="cashInflow">R$ 0,00</h3></div>
                    <div class="bg-dark-700 rounded-xl p-4"><p class="text-gray-400 text-sm">Saídas de Hoje</p><h3 class="text-2xl font-bold mt-1 text-red-500" id="cashOutflow">R$ 0,00</h3></div>
                </div>
                <div class="bg-dark-700 rounded-xl p-4 mb-6">
                    <h4 class="font-semibold mb-4">Registrar Lançamento</h4>
                    <form id="cashEntryForm" class="grid grid-cols-5 gap-4">
                        <div class="col-span-2"><label for="entryDescription" class="block text-sm text-gray-400 mb-1">Descrição</label><input type="text" id="entryDescription" required class="w-full bg-dark-600 border border-dark-500 rounded-lg px-3 py-2 text-white"></div>
                        <div><label for="entryValue" class="block text-sm text-gray-400 mb-1">Valor</label><input type="number" id="entryValue" step="0.01" required class="w-full bg-dark-600 border border-dark-500 rounded-lg px-3 py-2 text-white"></div>
                        <div><label for="entryPaymentMethod" class="block text-sm text-gray-400 mb-1">Meio de Pagamento</label><select id="entryPaymentMethod" class="w-full bg-dark-600 border border-dark-500 rounded-lg px-3 py-2 text-white"><option>DINHEIRO</option><option>PIX</option><option>CARTAO_CREDITO</option><option>CARTAO_DEBITO</option></select></div>
                        <div class="flex items-end gap-2"><button type="button" onclick="addCashEntry('inflow')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex-1">Entrada</button><button type="button" onclick="addCashEntry('outflow')" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg flex-1">Saída</button></div>
                    </form>
                </div>
                <div class="bg-dark-700 rounded-xl p-4"><h4 class="font-semibold mb-4">Histórico de Lançamentos</h4><table class="w-full"><thead><tr class="text-left text-sm text-gray-400"><th class="pb-2">Data/Hora</th><th class="pb-2">Descrição</th><th class="pb-2">Valor</th><th class="pb-2">Meio</th><th class="pb-2">Tipo</th></tr></thead><tbody id="cashHistoryTableBody" class="text-sm"></tbody></table></div>
            </div>
        </div>

        <div id="reportsModal" onclick="closeModalOnBackdrop(event, 'reportsModal')" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
            <div class="bg-dark-800 rounded-2xl p-8 max-w-5xl w-full border border-dark-600 max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
                <div class="flex items-center justify-between mb-6"><div class="flex items-center gap-3"><span class="material-icons text-blue-400 text-4xl">bar_chart</span><h3 class="text-2xl font-bold">Relatório de Desempenho</h3></div><button onclick="closeModal('reportsModal')" class="material-icons text-gray-400 hover:text-primary cursor-pointer">close</button></div>
                <div class="bg-dark-700 rounded-xl p-4 mb-6">
                    <h4 class="font-semibold mb-4">Filtros</h4>
                    <div class="grid grid-cols-4 gap-4">
                        <div><label class="block text-sm text-gray-400 mb-1">Profissional</label><select id="reportProfessional" class="w-full bg-dark-600 border border-dark-500 rounded-lg px-3 py-2 text-white"><option value="todos">Todos</option><option value="Carlos Silva">Carlos Silva</option><option value="Pedro Souza">Pedro Souza</option><option value="Lucas Lima">Lucas Lima</option></select></div>
                        <div><label class="block text-sm text-gray-400 mb-1">Data</label><input type="date" id="reportDate" class="w-full bg-dark-600 border border-dark-500 rounded-lg px-3 py-2 text-white"></div>
                        <div class="flex items-end"><button onclick="generatePerformanceReport()" class="bg-primary hover:bg-orange-600 text-white px-4 py-2 rounded-lg w-full">Gerar Relatório</button></div>
                    </div>
                </div>
                <div class="grid grid-cols-4 gap-6 mb-6">
                    <div class="bg-dark-700 rounded-xl p-4"><p class="text-gray-400 text-sm">Atendimentos</p><h3 class="text-2xl font-bold mt-1" id="reportTotalAppointments">0</h3></div>
                    <div class="bg-dark-700 rounded-xl p-4"><p class="text-gray-400 text-sm">Tempo Médio</p><h3 class="text-2xl font-bold mt-1" id="reportAvgTime">0 min</h3></div>
                    <div class="bg-dark-700 rounded-xl p-4"><p class="text-gray-400 text-sm">Receita Total</p><h3 class="text-2xl font-bold mt-1" id="reportTotalRevenue">R$ 0,00</h3></div>
                    <div class="bg-dark-700 rounded-xl p-4"><p class="text-gray-400 text-sm">Avaliação Média</p><h3 class="text-2xl font-bold mt-1" id="reportAvgRating">0.0</h3></div>
                </div>
                <div class="bg-dark-700 rounded-xl p-4"><h4 class="font-semibold mb-4">Detalhamento</h4><table class="w-full"><thead><tr class="text-left text-sm text-gray-400"><th class="pb-2">Profissional</th><th class="pb-2">Atendimentos</th><th class="pb-2">Tempo Médio</th><th class="pb-2">Receita</th><th class="pb-2">Avaliação</th></tr></thead><tbody id="performanceReportTableBody" class="text-sm"></tbody></table></div>
            </div>
        </div>
        
        <div id="professionalManagementModal" onclick="closeModalOnBackdrop(event, 'professionalManagementModal')" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"><div class="bg-dark-800 rounded-2xl p-8 max-w-6xl w-full border border-dark-600 max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()"><div class="flex items-center justify-between mb-6"><div class="flex items-center gap-3"><span class="material-icons text-primary text-4xl">people</span><h3 class="text-2xl font-bold">Gestão de Profissionais</h3></div><button onclick="closeModal('professionalManagementModal')" class="material-icons text-gray-400 hover:text-primary cursor-pointer">close</button></div><div class="flex justify-end mb-4"><button onclick="openNewProfessionalModal()" class="bg-primary hover:bg-primary/90 text-white px-5 py-2 rounded-lg font-medium transition flex items-center gap-2"><span class="material-icons">add</span>Cadastrar Novo</button></div><div class="bg-dark-700 rounded-xl overflow-hidden border border-dark-600"><table class="w-full"><thead class="bg-dark-600"><tr><th class="px-6 py-4 text-left text-sm font-semibold">Profissional</th><th class="px-6 py-4 text-left text-sm font-semibold">Nível</th><th class="px-6 py-4 text-left text-sm font-semibold">Jornada</th><th class="px-6 py-4 text-left text-sm font-semibold">Avaliação</th><th class="px-6 py-4 text-left text-sm font-semibold">Status</th><th class="px-6 py-4 text-left text-sm font-semibold">Ações</th></tr></thead><tbody id="professionalsTableBody" class="divide-y divide-dark-600"></tbody></table></div></div></div>
        <div id="professionalFormModal" onclick="closeModalOnBackdrop(event, 'professionalFormModal')" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"><div class="bg-dark-800 rounded-2xl p-8 max-w-2xl w-full border border-dark-600 max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()"><div class="flex items-center justify-between mb-6"><div class="flex items-center gap-3"><span class="material-icons text-primary text-4xl" id="professionalFormIcon">person_add</span><h3 class="text-2xl font-bold" id="professionalFormTitle">Cadastrar Novo Profissional</h3></div><button onclick="closeModal('professionalFormModal')" class="material-icons text-gray-400 hover:text-primary cursor-pointer">close</button></div><form onsubmit="submitProfessionalForm(event)" class="space-y-6"><input type="hidden" id="professionalFormId"><div><label class="block text-sm font-medium mb-2">Nome do Profissional *</label><input type="text" id="professionalFormName" required class="w-full bg-dark-700 border border-dark-600 rounded-lg px-4 py-3 text-white focus:border-primary focus:outline-none" placeholder="Ex: Carlos Silva"></div><div><label class="block text-sm font-medium mb-2">Nível *</label><select id="professionalFormLevel" required class="w-full bg-dark-700 border border-dark-600 rounded-lg px-4 py-3 text-white focus:border-primary focus:outline-none"><option value="Júnior">Júnior</option><option value="Pleno">Pleno</option><option value="Sênior">Sênior</option></select></div><div><label class="block text-sm font-medium mb-2">Descrição da Jornada *</label><input type="text" id="professionalFormJornada" required class="w-full bg-dark-700 border border-dark-600 rounded-lg px-4 py-3 text-white focus:border-primary focus:outline-none" placeholder="Ex: Seg-Sex (8h-18h)"></div><div><label class="block text-sm font-medium mb-2">Avaliação (Inicial)</label><input type="text" id="professionalFormRating" class="w-full bg-dark-700 border border-dark-600 rounded-lg px-4 py-3 text-white focus:border-primary focus:outline-none" placeholder="Ex: 5.0/5.0 (será atualizado por clientes)"></div><div class="flex gap-4 pt-4"><button type="button" onclick="closeModal('professionalFormModal')" class="flex-1 bg-dark-700 hover:bg-dark-600 text-gray-300 py-3 rounded-lg font-medium transition">Cancelar</button><button type="submit" class="flex-1 bg-primary hover:bg-primary/90 text-white py-3 rounded-lg font-medium transition">Salvar Profissional</button></div></form></div></div>
        <div id="jornadaModal" onclick="closeModalOnBackdrop(event, 'jornadaModal')" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"><div class="bg-dark-800 rounded-2xl p-8 max-w-2xl w-full border border-dark-600 max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()"><input type="hidden" id="jornadaProfessionalId"><div class="flex items-center justify-between mb-6"><div class="flex items-center gap-3"><span class="material-icons text-blue-400 text-4xl">schedule</span><h3 class="text-2xl font-bold">Definir Jornada de Trabalho</h3></div><button onclick="closeModal('jornadaModal')" class="material-icons text-gray-400 hover:text-primary cursor-pointer">close</button></div><h4 class="text-lg font-semibold mb-4 text-primary" id="jornadaProfessionalName"></h4><div class="space-y-4"><p class="text-sm text-gray-400">Aqui você pode definir os dias e horários de trabalho, além de registrar bloqueios e férias.</p><div class="grid grid-cols-3 gap-4"><div class="bg-dark-700 p-4 rounded-lg"><label class="flex items-center gap-2"><input type="checkbox" checked class="form-checkbox bg-dark-600 border-dark-500 text-primary">Segunda-feira</label><div class="flex gap-2 mt-2"><input type="time" value="08:00" class="w-full bg-dark-600 border border-dark-500 rounded-lg px-2 py-1 text-sm"><input type="time" value="18:00" class="w-full bg-dark-600 border border-dark-500 rounded-lg px-2 py-1 text-sm"></div></div><div class="bg-dark-700 p-4 rounded-lg"><label class="flex items-center gap-2"><input type="checkbox" checked class="form-checkbox bg-dark-600 border-dark-500 text-primary">Terça-feira</label><div class="flex gap-2 mt-2"><input type="time" value="08:00" class="w-full bg-dark-600 border border-dark-500 rounded-lg px-2 py-1 text-sm"><input type="time" value="18:00" class="w-full bg-dark-600 border border-dark-500 rounded-lg px-2 py-1 text-sm"></div></div><div class="bg-dark-700 p-4 rounded-lg"><label class="flex items-center gap-2"><input type="checkbox" checked class="form-checkbox bg-dark-600 border-dark-500 text-primary">Quarta-feira</label><div class="flex gap-2 mt-2"><input type="time" value="08:00" class="w-full bg-dark-600 border border-dark-500 rounded-lg px-2 py-1 text-sm"><input type="time" value="18:00" class="w-full bg-dark-600 border border-dark-500 rounded-lg px-2 py-1 text-sm"></div></div><div class="bg-dark-700 p-4 rounded-lg"><label class="flex items-center gap-2"><input type="checkbox" checked class="form-checkbox bg-dark-600 border-dark-500 text-primary">Quinta-feira</label><div class="flex gap-2 mt-2"><input type="time" value="08:00" class="w-full bg-dark-600 border border-dark-500 rounded-lg px-2 py-1 text-sm"><input type="time" value="18:00" class="w-full bg-dark-600 border border-dark-500 rounded-lg px-2 py-1 text-sm"></div></div><div class="bg-dark-700 p-4 rounded-lg"><label class="flex items-center gap-2"><input type="checkbox" checked class="form-checkbox bg-dark-600 border-dark-500 text-primary">Sexta-feira</label><div class="flex gap-2 mt-2"><input type="time" value="08:00" class="w-full bg-dark-600 border border-dark-500 rounded-lg px-2 py-1 text-sm"><input type="time" value="18:00" class="w-full bg-dark-600 border border-dark-500 rounded-lg px-2 py-1 text-sm"></div></div><div class="bg-dark-700 p-4 rounded-lg"><label class="flex items-center gap-2"><input type="checkbox" class="form-checkbox bg-dark-600 border-dark-500 text-primary">Sábado</label><div class="flex gap-2 mt-2"><input type="time" class="w-full bg-dark-600 border border-dark-500 rounded-lg px-2 py-1 text-sm" disabled><input type="time" class="w-full bg-dark-600 border border-dark-500 rounded-lg px-2 py-1 text-sm" disabled></div></div></div></div><div class="flex gap-4 pt-6"><button type="button" onclick="closeModal('jornadaModal')" class="flex-1 bg-dark-700 hover:bg-dark-600 text-gray-300 py-3 rounded-lg font-medium transition">Cancelar</button><button type="button" onclick="submitJornada()" class="flex-1 bg-primary hover:bg-primary/90 text-white py-3 rounded-lg font-medium transition">Salvar Jornada</button></div></div></div>
        <div id="serviceManagementModal" onclick="closeModalOnBackdrop(event, 'serviceManagementModal')" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"><div class="bg-dark-800 rounded-2xl p-8 max-w-6xl w-full border border-dark-600 max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()"><div class="flex items-center justify-between mb-6"><div class="flex items-center gap-3"><span class="material-icons text-blue-400 text-4xl">content_cut</span><h3 class="text-2xl font-bold">Gestão de Serviços</h3></div><button onclick="closeModal('serviceManagementModal')" class="material-icons text-gray-400 hover:text-primary cursor-pointer">close</button></div><div class="flex justify-end mb-4"><button onclick="openNewServiceModal()" class="bg-primary hover:bg-primary/90 text-white px-5 py-2 rounded-lg font-medium transition flex items-center gap-2"><span class="material-icons">add</span>Cadastrar Novo</button></div><div class="bg-dark-700 rounded-xl overflow-hidden border border-dark-600"><table class="w-full"><thead class="bg-dark-600"><tr><th class="px-6 py-4 text-left text-sm font-semibold">Serviço</th><th class="px-6 py-4 text-left text-sm font-semibold">Categoria</th><th class="px-6 py-4 text-left text-sm font-semibold">Duração</th><th class="px-6 py-4 text-left text-sm font-semibold">Preço</th><th class="px-6 py-4 text-left text-sm font-semibold">Profissionais</th><th class="px-6 py-4 text-left text-sm font-semibold">Status</th><th class="px-6 py-4 text-left text-sm font-semibold">Ações</th></tr></thead><tbody id="servicesTableBody" class="divide-y divide-dark-600"></tbody></table></div></div></div>
        <div id="serviceFormModal" onclick="closeModalOnBackdrop(event, 'serviceFormModal')" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"><div class="bg-dark-800 rounded-2xl p-8 max-w-2xl w-full border border-dark-600 max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()"><div class="flex items-center justify-between mb-6"><div class="flex items-center gap-3"><span class="material-icons text-blue-400 text-4xl" id="serviceFormIcon">add_circle</span><h3 class="text-2xl font-bold" id="serviceFormTitle">Cadastrar Novo Serviço</h3></div><button onclick="closeModal('serviceFormModal')" class="material-icons text-gray-400 hover:text-primary cursor-pointer">close</button></div><form onsubmit="submitServiceForm(event)" class="space-y-6"><input type="hidden" id="serviceFormId"><div><label class="block text-sm font-medium mb-2">Nome do Serviço *</label><input type="text" id="serviceFormName" required class="w-full bg-dark-700 border border-dark-600 rounded-lg px-4 py-3 text-white focus:border-primary focus:outline-none" placeholder="Ex: Corte Simples"></div><div><label class="block text-sm font-medium mb-2">Categoria *</label><input type="text" id="serviceFormCategory" required class="w-full bg-dark-700 border border-dark-600 rounded-lg px-4 py-3 text-white focus:border-primary focus:outline-none" placeholder="Ex: Cortes, Barba, Pacotes"></div><div><label class="block text-sm font-medium mb-2">Duração (minutos) *</label><input type="number" id="serviceFormDuration" required class="w-full bg-dark-700 border border-dark-600 rounded-lg px-4 py-3 text-white focus:border-primary focus:outline-none" placeholder="Ex: 30"></div><div><label class="block text-sm font-medium mb-2">Preço (R$) *</label><input type="number" step="0.01" id="serviceFormPrice" required class="w-full bg-dark-700 border border-dark-600 rounded-lg px-4 py-3 text-white focus:border-primary focus:outline-none" placeholder="Ex: 35.00"></div><div class="flex gap-4 pt-4"><button type="button" onclick="closeModal('serviceFormModal')" class="flex-1 bg-dark-700 hover:bg-dark-600 text-gray-300 py-3 rounded-lg font-medium transition">Cancelar</button><button type="submit" class="flex-1 bg-primary hover:bg-primary/90 text-white py-3 rounded-lg font-medium transition">Salvar Serviço</button></div></form></div></div>
        <div id="associateProfessionalModal" onclick="closeModalOnBackdrop(event, 'associateProfessionalModal')" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4"><div class="bg-dark-800 rounded-2xl p-8 max-w-lg w-full border border-dark-600 max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()"><input type="hidden" id="associateServiceId"><div class="flex items-center justify-between mb-6"><div class="flex items-center gap-3"><span class="material-icons text-blue-400 text-4xl">group_add</span><h3 class="text-2xl font-bold">Associar Profissionais</h3></div><button onclick="closeModal('associateProfessionalModal')" class="material-icons text-gray-400 hover:text-primary cursor-pointer">close</button></div><h4 class="text-lg font-semibold mb-1 text-primary" id="associateServiceName"></h4><p class="text-sm text-gray-400 mb-6">Selecione os profissionais que podem realizar este serviço.</p><div id="associateProfessionalList" class="space-y-3 max-h-60 overflow-y-auto pr-2"></div><div class="flex gap-4 pt-6 border-t border-dark-600 mt-6"><button type="button" onclick="closeModal('associateProfessionalModal')" class="flex-1 bg-dark-700 hover:bg-dark-600 text-gray-300 py-3 rounded-lg font-medium transition">Cancelar</button><button type="button" onclick="submitAssociation()" class="flex-1 bg-primary hover:bg-primary/90 text-white py-3 rounded-lg font-medium transition">Salvar Associações</button></div></div></div>
        <div id="toast" class="hidden fixed top-8 right-8 bg-dark-800 border rounded-lg p-4 shadow-2xl z-50 max-w-sm"><div class="flex items-center gap-3"><span id="toastIcon" class="material-icons">check_circle</span><div><p class="font-semibold" id="toastTitle"></p><p class="text-sm text-gray-400" id="toastMessage"></p></div></div></div>
    </div>

    <script>
        // --- BANCO DE DADOS (EM MEMÓRIA) ---
        let cashFlowHistory = [
            { date: '2025-10-19T10:30:00', description: 'Corte Social - Lucas', value: 45.00, method: 'DINHEIRO', type: 'inflow' },
            { date: '2025-10-19T09:00:00', description: 'Corte + Barba - João', value: 60.00, method: 'PIX', type: 'inflow' },
            { date: '2025-10-18T16:00:00', description: 'Compra de Shampoo', value: 30.00, method: 'PIX', type: 'outflow' }
        ];

        const performanceData = [
            { date: '2025-10-19', professional: 'Carlos Silva', appointments: 8, totalTime: 320, revenue: 440.00, ratings: [5, 4, 5, 5] },
            { date: '2025-10-19', professional: 'Pedro Souza', appointments: 7, totalTime: 245, revenue: 385.00, ratings: [4, 4, 5] },
            { date: '2025-10-19', professional: 'Lucas Lima', appointments: 6, totalTime: 270, revenue: 330.00, ratings: [5, 5, 5, 4, 5] },
            { date: '2025-10-18', professional: 'Carlos Silva', appointments: 10, totalTime: 400, revenue: 550.00, ratings: [5, 5, 4, 5, 5] },
            { date: '2025-10-18', professional: 'Lucas Lima', appointments: 7, totalTime: 315, revenue: 385.00, ratings: [4, 5, 5] },
        ];
        
        // Dados de profissionais e serviços (inalterados)
        let professionalsData = [{ id: 'p1', name: 'Carlos Silva', level: 'Sênior', jornada: 'Seg-Sex (8h-18h)', rating: '4.9/5.0', status: 'Ativo' },{ id: 'p2', name: 'Pedro Souza', level: 'Pleno', jornada: 'Seg-Sáb (10h-20h)', rating: '4.7/5.0', status: 'Ativo' },{ id: 'p3', name: 'Lucas Lima', level: 'Sênior', jornada: 'Ter-Sáb (8h-18h)', rating: '4.8/5.0', status: 'Ativo' },{ id: 'p4', name: 'Marcos Andrade', level: 'Sênior', jornada: 'N/A', rating: '4.5/5.0', status: 'Inativo' }];
        let servicesData = [{ id: 's1', name: 'Corte Simples', category: 'Cortes', duration: 30, price: 35.00, assignedProfessionals: '3/4', status: 'Ativo', assignedProfIds: ['p1', 'p2', 'p3'] },{ id: 's2', name: 'Corte + Barba', category: 'Pacotes', duration: 50, price: 60.00, assignedProfessionals: '2/4', status: 'Ativo', assignedProfIds: ['p1', 'p4'] },{ id: 's3', name: 'Barba Completa', category: 'Barba', duration: 25, price: 30.00, assignedProfessionals: '4/4', status: 'Ativo', assignedProfIds: ['p1', 'p2', 'p3', 'p4'] },{ id: 's4', name: 'Corte Social', category: 'Cortes', duration: 40, price: 45.00, assignedProfessionals: '1/4', status: 'Inativo', assignedProfIds: ['p1'] },{ id: 's5', name: 'Corte Infantil', category: 'Cortes', duration: 25, price: 30.00, assignedProfessionals: '2/4', status: 'Ativo', assignedProfIds: ['p2', 'p3'] },{ id: 's6', name: 'Barba Express', category: 'Barba', duration: 15, price: 20.00, assignedProfessionals: '3/4', status: 'Ativo', assignedProfIds: ['p1', 'p3', 'p4'] }];


        // --- FUNÇÕES DO CONTROLE DE CAIXA ---
        function renderCashFlowHistory() {
            const tableBody = document.getElementById('cashHistoryTableBody');
            tableBody.innerHTML = '';
            const sortedHistory = [...cashFlowHistory].sort((a, b) => new Date(b.date) - new Date(a.date));
            sortedHistory.forEach(entry => {
                const row = document.createElement('tr');
                row.className = 'border-t border-dark-600';
                const isIncome = entry.type === 'inflow';
                const valueClass = isIncome ? 'text-green-500' : 'text-red-500';
                const valuePrefix = isIncome ? '+ R$' : '- R$';
                row.innerHTML = `<td class="py-2">${new Date(entry.date).toLocaleString('pt-BR')}</td><td class="py-2">${entry.description}</td><td class="py-2 ${valueClass}">${valuePrefix} ${entry.value.toFixed(2).replace('.', ',')}</td><td class="py-2">${entry.method}</td><td class="py-2"><span class="status-badge ${isIncome ? 'bg-green-500/10 text-green-400' : 'bg-red-500/10 text-red-400'} px-2 py-1 rounded-full text-xs">${isIncome ? 'Entrada' : 'Saída'}</span></td>`;
                tableBody.appendChild(row);
            });
            updateCashSummary();
        }

        function addCashEntry(type) {
            const descriptionInput = document.getElementById('entryDescription');
            const valueInput = document.getElementById('entryValue');
            const methodInput = document.getElementById('entryPaymentMethod');
            if (!descriptionInput.value || !valueInput.value) {
                showToast('Erro', 'Descrição e valor são obrigatórios.', 'error', 'red');
                return;
            }
            cashFlowHistory.push({ date: new Date().toISOString(), description: descriptionInput.value, value: parseFloat(valueInput.value), method: methodInput.value, type: type });
            showToast('Sucesso', `Lançamento de ${type === 'inflow' ? 'entrada' : 'saída'} registrado.`, 'check_circle');
            document.getElementById('cashEntryForm').reset();
            renderCashFlowHistory();
        }

        function updateCashSummary() {
            const todayStr = new Date().toISOString().slice(0, 10);
            const todayEntries = cashFlowHistory.filter(e => e.date.startsWith(todayStr));
            const inflow = todayEntries.filter(e => e.type === 'inflow').reduce((sum, e) => sum + e.value, 0);
            const outflow = todayEntries.filter(e => e.type === 'outflow').reduce((sum, e) => sum + e.value, 0);
            const balance = cashFlowHistory.reduce((bal, e) => bal + (e.type === 'inflow' ? e.value : -e.value), 0);
            document.getElementById('cashBalance').textContent = `R$ ${balance.toFixed(2).replace('.', ',')}`;
            document.getElementById('cashInflow').textContent = `R$ ${inflow.toFixed(2).replace('.', ',')}`;
            document.getElementById('cashOutflow').textContent = `R$ ${outflow.toFixed(2).replace('.', ',')}`;
        }

        // --- FUNÇÕES DO RELATÓRIO DE DESEMPENHO ---
        function generatePerformanceReport() {
            const professional = document.getElementById('reportProfessional').value;
            const date = document.getElementById('reportDate').value;
            let filteredData = performanceData;
            if (date) filteredData = filteredData.filter(d => d.date === date);
            if (professional !== 'todos') filteredData = filteredData.filter(d => d.professional === professional);
            if (filteredData.length === 0) {
                showToast('Atenção', 'Nenhum dado encontrado para os filtros selecionados.', 'warning', 'yellow');
                renderPerformanceReport([]); // Limpa a tabela e os cards
                return;
            }
            renderPerformanceReport(filteredData);
        }

        function renderPerformanceReport(data) {
            const tableBody = document.getElementById('performanceReportTableBody');
            tableBody.innerHTML = '';
            const professionalStats = data.reduce((acc, curr) => {
                if (!acc[curr.professional]) acc[curr.professional] = { appointments: 0, totalTime: 0, revenue: 0, ratings: [] };
                acc[curr.professional].appointments += curr.appointments;
                acc[curr.professional].totalTime += curr.totalTime;
                acc[curr.professional].revenue += curr.revenue;
                acc[curr.professional].ratings.push(...curr.ratings);
                return acc;
            }, {});

            let totalAppointments = 0, totalRevenue = 0, totalTime = 0, totalRatingsSum = 0, totalRatingsCount = 0;
            for (const profName in professionalStats) {
                const stats = professionalStats[profName];
                const avgTime = stats.appointments > 0 ? (stats.totalTime / stats.appointments).toFixed(1) : 0;
                const avgRating = stats.ratings.length > 0 ? (stats.ratings.reduce((a, b) => a + b, 0) / stats.ratings.length).toFixed(1) : 'N/A';
                totalAppointments += stats.appointments; totalRevenue += stats.revenue; totalTime += stats.totalTime;
                if (stats.ratings.length > 0) { totalRatingsSum += stats.ratings.reduce((a, b) => a + b, 0); totalRatingsCount += stats.ratings.length; }
                const row = document.createElement('tr');
                row.className = 'border-t border-dark-600';
                row.innerHTML = `<td class="py-2">${profName}</td><td class="py-2">${stats.appointments}</td><td class="py-2">${avgTime} min</td><td class="py-2">R$ ${stats.revenue.toFixed(2).replace('.', ',')}</td><td class="py-2">${avgRating}/5.0</td>`;
                tableBody.appendChild(row);
            }
            document.getElementById('reportTotalAppointments').textContent = totalAppointments;
            document.getElementById('reportTotalRevenue').textContent = `R$ ${totalRevenue.toFixed(2).replace('.', ',')}`;
            document.getElementById('reportAvgTime').textContent = `${(totalAppointments > 0 ? totalTime / totalAppointments : 0).toFixed(1)} min`;
            document.getElementById('reportAvgRating').textContent = (totalRatingsCount > 0 ? (totalRatingsSum / totalRatingsCount).toFixed(1) : '0.0');
        }

        // --- FUNÇÕES DE UI (GERAIS) ---
        function openAdminModal(modalType) {
            if (modalType === 'cashControl') {
                renderCashFlowHistory();
                document.getElementById('cashControlModal').classList.remove('hidden');
            } else if (modalType === 'reports') {
                generatePerformanceReport();
                document.getElementById('reportsModal').classList.remove('hidden');
            } else if (modalType === 'professionalManagement') {
                document.getElementById('professionalManagementModal').classList.remove('hidden');
            } else if (modalType === 'serviceManagement') {
                document.getElementById('serviceManagementModal').classList.remove('hidden');
            } else {
                showToast('Em breve', 'Esta funcionalidade estará disponível em breve.', 'info', 'info');
            }
        }
        
        // Funções de login, logout, etc. (inalteradas e resumidas para brevidade)
        function selectProfile(p){currentProfile=p;document.getElementById('profileSelection').classList.add('hidden');document.getElementById('loginScreen').classList.remove('hidden');const s=document.getElementById('loginSubtitle');if(p==='admin')s.textContent='Entrando como Administrador';else if(p==='professional')s.textContent='Entrando como Profissional';else s.textContent='Entrando como Cliente'}
        function login(e){e.preventDefault();document.getElementById('loginScreen').classList.add('hidden');if(currentProfile==='admin'){document.getElementById('adminPanel').classList.remove('hidden');renderProfessionalsTable();renderServicesTable()}else if(currentProfile==='professional')document.getElementById('professionalPanel').classList.remove('hidden');else document.getElementById('clientPanel').classList.remove('hidden')}
        function backToProfileSelection(){document.getElementById('loginScreen').classList.add('hidden');document.getElementById('profileSelection').classList.remove('hidden')}
        function logout(){document.querySelectorAll('#app > div').forEach(e=>e.classList.add('hidden'));document.getElementById('profileSelection').classList.remove('hidden')}
        function closeModal(id){document.getElementById(id).classList.add('hidden')}
        function closeModalOnBackdrop(e,id){if(e.target.id===id)closeModal(id)}
        function showToast(t,m,i='check_circle',c='primary'){const o=document.getElementById('toast'),n=document.getElementById('toastIcon');document.getElementById('toastTitle').textContent=t;document.getElementById('toastMessage').textContent=m;n.textContent=i;o.className='fixed top-8 right-8 bg-dark-800 border rounded-lg p-4 shadow-2xl z-50 max-w-sm toast';n.className='material-icons';const l={red:['text-red-400','border-red-400'],yellow:['text-yellow-400','border-yellow-400'],info:['text-blue-400','border-blue-400'],primary:['text-primary','border-primary']},[a,d]=l[c]||l.primary;n.classList.add(a);o.classList.add(d);o.classList.remove('hidden');setTimeout(()=>o.classList.add('hidden'),4e3)}
        // Funções de gestão (profissionais, serviços, etc.)
        function renderProfessionalsTable(){const e=document.getElementById("professionalsTableBody");if(!e)return;e.innerHTML="";professionalsData.forEach(t=>{const n=t.status==="Inativo",o=n?`<button onclick="toggleProfessionalStatus('${t.id}')" class="bg-green-500/10 text-green-400 hover:bg-green-500/20 px-3 py-1.5 rounded-lg text-sm font-medium transition">Reativar</button>`:`\n                    <button onclick="openJornadaModal('${t.id}')" class="bg-blue-500/10 text-blue-400 hover:bg-blue-500/20 px-3 py-1.5 rounded-lg text-sm font-medium transition">Jornada</button>\n                    <button onclick="openEditProfessionalModal('${t.id}')" class="bg-yellow-500/10 text-yellow-400 hover:bg-yellow-500/20 px-3 py-1.5 rounded-lg text-sm font-medium transition">Editar</button>\n                    <button onclick="toggleProfessionalStatus('${t.id}')" class="bg-red-500/10 text-red-400 hover:bg-red-500/20 px-3 py-1.5 rounded-lg text-sm font-medium transition">Desativar</button>\n                `,s=`\n                <tr class="hover:bg-dark-800 ${n?"opacity-60":""}">\n                    <td class="px-6 py-4 font-medium">${t.name}</td>\n                    <td class="px-6 py-4">${t.level}</td>\n                    <td class="px-6 py-4">${t.jornada}</td>\n                    <td class="px-6 py-4">${t.rating}</td>\n                    <td class="px-6 py-4">\n                        <span class="${n?"bg-red-500/10 text-red-400":"bg-green-500/10 text-green-400"} px-3 py-1 rounded-full text-sm">${t.status}</span>\n                    </td>\n                    <td class="px-6 py-4">\n                        <div class="flex gap-2">${o}</div>\n                    </td>\n                </tr>\n            `;e.innerHTML+=s})}
        function openNewProfessionalModal(){document.getElementById("professionalFormId").value="";document.getElementById("professionalFormName").value="";document.getElementById("professionalFormLevel").value="Júnior";document.getElementById("professionalFormJornada").value="Seg-Sex (8h-18h)";document.getElementById("professionalFormRating").value="5.0/5.0";document.getElementById("professionalFormTitle").textContent="Cadastrar Novo Profissional";document.getElementById("professionalFormIcon").textContent="person_add";document.getElementById("professionalFormModal").classList.remove("hidden")}
        function openEditProfessionalModal(e){const t=professionalsData.find(t=>t.id===e);if(!t)return;document.getElementById("professionalFormId").value=t.id;document.getElementById("professionalFormName").value=t.name;document.getElementById("professionalFormLevel").value=t.level;document.getElementById("professionalFormJornada").value=t.jornada;document.getElementById("professionalFormRating").value=t.rating;document.getElementById("professionalFormTitle").textContent="Editar Profissional";document.getElementById("professionalFormIcon").textContent="edit";document.getElementById("professionalFormModal").classList.remove("hidden")}
        function submitProfessionalForm(e){e.preventDefault();const t=document.getElementById("professionalFormId").value,n=document.getElementById("professionalFormName").value,o=document.getElementById("professionalFormLevel").value,s=document.getElementById("professionalFormJornada").value,i=document.getElementById("professionalFormRating").value;if(t){const e=professionalsData.findIndex(e=>e.id===t);-1!==e&&(professionalsData[e]={...professionalsData[e],name:n,level:o,jornada:s,rating:i});showToast("Sucesso!","Profissional atualizado com sucesso.","check_circle")}else{const e={id:"p"+(new Date).getTime(),name:n,level:o,jornada:s,rating:i||"N/A",status:"Ativo"};professionalsData.push(e);showToast("Sucesso!","Profissional cadastrado com sucesso.","check_circle")}closeModal("professionalFormModal");renderProfessionalsTable()}
        function toggleProfessionalStatus(e){const t=professionalsData.findIndex(t=>t.id===e);if(-1===t)return;const n=professionalsData[t],o=n.status==="Inativo",s=o?`Deseja realmente REATIVAR ${n.name}?`:`Deseja realmente DESATIVAR ${n.name}? Isso irá ocultá-lo de novos agendamentos.`;confirm(s)&&(n.status=o?"Ativo":"Inativo",showToast("Status Alterado",o?"Profissional reativado.":"Profissional desativado.","info","info"),renderProfessionalsTable(),renderServicesTable())}
        function openJornadaModal(e){const t=professionalsData.find(t=>t.id===e);if(!t)return;document.getElementById("jornadaProfessionalId").value=t.id;document.getElementById("jornadaProfessionalName").textContent=t.name;document.getElementById("jornadaModal").classList.remove("hidden")}
        function submitJornada(){const e=document.getElementById("jornadaProfessionalId").value,t=professionalsData.find(t=>t.id===e);closeModal("jornadaModal");showToast("Jornada Salva!",`A jornada de ${t.name} foi atualizada.`,"check_circle")}
        function renderServicesTable(){const e=document.getElementById("servicesTableBody");if(!e)return;e.innerHTML="";const t=professionalsData.filter(e=>"Ativo"===e.status).length;servicesData.forEach(n=>{const o=n.status==="Inativo",s=n.assignedProfIds.filter(e=>{const t=professionalsData.find(t=>t.id===e);return t&&"Ativo"===t.status}).length,i=`${s}/${t}`;n.assignedProfessionals=i;const a=o?`<button onclick="toggleServiceStatus('${n.id}')" class="bg-green-500/10 text-green-400 hover:bg-green-500/20 px-3 py-1.5 rounded-lg text-sm font-medium transition">Reativar</button>`:`\n                    <button onclick="openAssociateProfessionalModal('${n.id}')" class="bg-blue-500/10 text-blue-400 hover:bg-blue-500/20 px-3 py-1.5 rounded-lg text-sm font-medium transition">Associar</button>\n                    <button onclick="openEditServiceModal('${n.id}')" class="bg-yellow-500/10 text-yellow-400 hover:bg-yellow-500/20 px-3 py-1.5 rounded-lg text-sm font-medium transition">Editar</button>\n                    <button onclick="toggleServiceStatus('${n.id}')" class="bg-red-500/10 text-red-400 hover:bg-red-500/20 px-3 py-1.5 rounded-lg text-sm font-medium transition">Desativar</button>\n                `,d=`\n                <tr class="hover:bg-dark-800 ${o?"opacity-60":""}">\n                    <td class="px-6 py-4 font-medium">${n.name}</td>\n                    <td class="px-6 py-4">${n.category}</td>\n                    <td class="px-6 py-4">${n.duration} min</td>\n                    <td class="px-6 py-4">R$ ${n.price.toFixed(2).replace(".",",")}</td>\n                    <td class="px-6 py-4">${i}</td>\n                     <td class="px-6 py-4">\n                        <span class="${o?"bg-red-500/10 text-red-400":"bg-green-500/10 text-green-400"} px-3 py-1 rounded-full text-sm">${n.status}</span>\n                    </td>\n                    <td class="px-6 py-4">\n                        <div class="flex gap-2">${a}</div>\n                    </td>\n                </tr>\n            `;e.innerHTML+=d})}
        function openNewServiceModal(){document.getElementById("serviceFormId").value="";document.getElementById("serviceFormName").value="";document.getElementById("serviceFormCategory").value="";document.getElementById("serviceFormDuration").value="";document.getElementById("serviceFormPrice").value="";document.getElementById("serviceFormTitle").textContent="Cadastrar Novo Serviço";document.getElementById("serviceFormIcon").textContent="add_circle";document.getElementById("serviceFormModal").classList.remove("hidden")}
        function openEditServiceModal(e){const t=servicesData.find(t=>t.id===e);if(!t)return;document.getElementById("serviceFormId").value=t.id;document.getElementById("serviceFormName").value=t.name;document.getElementById("serviceFormCategory").value=t.category;document.getElementById("serviceFormDuration").value=t.duration;document.getElementById("serviceFormPrice").value=t.price.toFixed(2);document.getElementById("serviceFormTitle").textContent="Editar Serviço";document.getElementById("serviceFormIcon").textContent="edit";document.getElementById("serviceFormModal").classList.remove("hidden")}
        function submitServiceForm(e){e.preventDefault();const t=document.getElementById("serviceFormId").value,n=document.getElementById("serviceFormName").value,o=document.getElementById("serviceFormCategory").value,s=parseInt(document.getElementById("serviceFormDuration").value),i=parseFloat(document.getElementById("serviceFormPrice").value);if(isNaN(s)||isNaN(i)||s<=0||i<0)return void showToast("Erro","Duração e Preço devem ser números válidos.","error","red");if(t){const e=servicesData.findIndex(e=>e.id===t);-1!==e&&(servicesData[e]={...servicesData[e],name:n,category:o,duration:s,price:i});showToast("Sucesso!","Serviço atualizado com sucesso.","check_circle")}else{const e={id:"s"+(new Date).getTime(),name:n,category:o,duration:s,price:i,assignedProfessionals:`0/${professionalsData.filter(e=>"Ativo"===e.status).length}`,status:"Ativo",assignedProfIds:[]};servicesData.push(e);showToast("Sucesso!","Serviço cadastrado com sucesso.","check_circle")}closeModal("serviceFormModal");renderServicesTable()}
        function toggleServiceStatus(e){const t=servicesData.findIndex(t=>t.id===e);if(-1===t)return;const n=servicesData[t],o=n.status==="Inativo",s=o?`Deseja realmente REATIVAR o serviço "${n.name}"?`:`Deseja realmente DESATIVAR o serviço "${n.name}"? Clientes não poderão mais agendá-lo.`;confirm(s)&&(n.status=o?"Ativo":"Inativo",showToast("Status Alterado",o?"Serviço reativado.":"Serviço desativado.","info","info"),renderServicesTable())}
        function openAssociateProfessionalModal(e){const t=servicesData.find(t=>t.id===e);if(!t)return;document.getElementById("associateServiceId").value=e;document.getElementById("associateServiceName").textContent=t.name;const n=document.getElementById("associateProfessionalList");n.innerHTML="";const o=professionalsData.filter(e=>"Ativo"===e.status);0===o.length?n.innerHTML='<p class="text-sm text-gray-400">Nenhum profissional ativo encontrado.</p>':o.forEach(e=>{const o=t.assignedProfIds.includes(e.id),s=`\n                    <label class="flex items-center gap-2 bg-dark-700 p-2 rounded hover:bg-dark-600 cursor-pointer">\n                        <input type="checkbox" value="${e.id}" ${o?"checked":""} class="form-checkbox professional-association-checkbox bg-dark-600 border-dark-500 text-primary focus:ring-primary">\n                        <span>${e.name} (${e.level})</span>\n                    </label>\n                `;n.innerHTML+=s});document.getElementById("associateProfessionalModal").classList.remove("hidden")}
        function submitAssociation(){const e=document.getElementById("associateServiceId").value,t=servicesData.findIndex(t=>t.id===e);if(-1===t)return;const n=document.querySelectorAll(".professional-association-checkbox:checked"),o=Array.from(n).map(e=>e.value);servicesData[t].assignedProfIds=o;const s=professionalsData.filter(e=>"Ativo"===e.status).length;servicesData[t].assignedProfessionals=`${o.length}/${s}`;closeModal("associateProfessionalModal");renderServicesTable();showToast("Associações Salvas!","Os profissionais foram associados ao serviço.","check_circle")}
    </script>
</body>
</html>