<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Barber Booker — Prototype</title>
    <meta name="description" content="Prototype barber shop booking app (single-file)">
    <style>
      :root{
        --bg: #111416;
        --surface: #171A1F;
        --muted: #22262E;
        --muted-2:#1C2027;
        --text: #E8ECF1;
        --text-dim:#AAB4C0;
        --accent:#FF7A1A;   /* orange */
        --accent-2:#FFB266; /* soft orange */
        --danger:#FF4D4D;
        --success:#2ECC71;
        --shadow: 0 8px 30px rgba(0,0,0,.35);
        --radius: 14px;
      }
      *{ box-sizing:border-box }
      html,body{ height:100% }
      body{
        margin:0;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;
        color:var(--text);
        background:radial-gradient(1200px 800px at 100% -10%, #14181c 0%, var(--bg) 60%);
        letter-spacing:.2px;
      }
      a{ color:var(--accent) }
      .app{
        max-width:1100px;
        margin-inline:auto;
        padding: clamp(16px, 3vw, 28px);
      }
      header{
        display:flex; align-items:center; justify-content:space-between;
        gap:12px; padding:10px 4px 18px; position:sticky; top:0; z-index:10;
        background: linear-gradient(180deg, rgba(17,20,22,.9), rgba(17,20,22,.6) 70%, transparent);
        -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px);
      }
      .brand{ display:flex; align-items:center; gap:10px; }
      .brand .logo{
        width:44px; height:44px; border-radius:12px; background:linear-gradient(135deg, var(--accent), #ff5a1a);
        display:grid; place-items:center; color:#111; font-weight:800; box-shadow:var(--shadow);
      }
      .brand h1{ font-size:20px; margin:0; letter-spacing:.4px }
      .brand small{ display:block; color:var(--text-dim); font-size:12px }

      .grid{
        display:grid; gap:16px;
      }
      @media (min-width: 920px){
        .grid{ grid-template-columns: 380px 1fr; align-items:start }
      }

      .card{
        background: linear-gradient(180deg, var(--surface), var(--muted-2));
        border:1px solid #222a34; border-radius: var(--radius);
        box-shadow: var(--shadow);
      }
      .section{ padding:18px }
      .section + .section{ border-top:1px solid #212831 }
      .section h2{ margin:0 0 12px; font-size:16px; color:#f1f3f6 }
      .subtle{ color:var(--text-dim); font-size:13px }

      .seg{
        display:flex; gap:8px; flex-wrap:wrap;
      }
      .seg .chip{
        border:1px solid #2a313b; background:#14181d; color:var(--text);
        padding:10px 12px; border-radius:12px; cursor:pointer; display:flex; gap:10px; align-items:center;
        transition: .15s ease border-color, .15s ease background, .15s ease transform;
      }
      .seg .chip:hover{ border-color:#3a4451 }
      .seg input{ display:none }
      .seg input:checked + .chip{ border-color: var(--accent); background: linear-gradient(180deg, #161a1f, #13171c); box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--accent) 30%, #0000) }
      .seg .dur{ color:var(--accent-2); font-weight:600; font-variant-numeric: tabular-nums; font-size:12px }

      .pro-list{ display:flex; flex-direction:column; gap:10px }
      .pro{
        display:flex; align-items:center; gap:12px; padding:10px; border-radius:12px;
        border:1px solid #2a313b; background:#12161b; cursor:pointer;
      }
      .pro:hover{ border-color:#3a4451 }
      .pro input{ margin-right:6px }
      .avatar{
        width:36px; height:36px; border-radius:50%; background:#0f1216; display:grid; place-items:center; font-weight:700;
        border:1px solid #2a313b; color:#FFCF9C;
      }
      .pro .meta{ display:flex; flex-direction:column; line-height:1.1 }
      .pro .name{ font-weight:600 }
      .pro .role{ font-size:12px; color:var(--text-dim) }

      .inputs{ display:grid; gap:12px }
      .field{ display:grid; gap:6px }
      label{ font-size:13px; color:#cfd6de }
      input[type="text"], input[type="tel"], input[type="date"], select{
        width:100%; padding:12px 12px; border-radius:10px; border:1px solid #2a313b; background:#0f1317; color:var(--text);
        outline: none; transition:border-color .15s ease, background .15s ease;
      }
      input:focus, select:focus{ border-color:var(--accent) }

      .slots{
        display:grid; grid-template-columns: repeat(4, 1fr); gap:8px;
      }
      @media (min-width: 520px){ .slots{ grid-template-columns: repeat(6, 1fr) } }
      @media (min-width: 920px){ .slots{ grid-template-columns: repeat(8, 1fr) } }
      .slot{
        padding:10px 8px; border-radius:10px; border:1px solid #2a313b; background:#0f1317; color:#dfe5ec;
        font-size:13px; text-align:center; cursor:pointer; transition:.15s ease all;
      }
      .slot[disabled]{ opacity:.35; cursor:not-allowed; text-decoration: line-through }
      .slot.selected{ border-color: var(--accent); box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--accent) 30%, #0000) }
      .closed{ background: #171b20; border:1px dashed #333b46; color:var(--text-dim); padding:14px; border-radius:12px; text-align:center }

      .actions{ display:flex; gap:10px; align-items:center; flex-wrap:wrap }
      .btn{
        appearance:none; padding:12px 14px; border-radius:12px; border:1px solid transparent; cursor:pointer; font-weight:700;
        transition:.15s ease transform, .15s ease background, .15s ease border-color; background: var(--accent); color:#111;
      }
      .btn:hover{ transform: translateY(-1px) }
      .btn.secondary{ background:#12161b; color:var(--text); border-color:#2a313b }
      .btn.ghost{ background:transparent; border-color:#2a313b; color:var(--text) }
      .btn.danger{ background: var(--danger); color:#fff }
      .btn:disabled{ opacity:.5; cursor:not-allowed; transform:none }

      .summary{
        display:grid; gap:6px; padding:12px; border-radius:12px; background:#101419; border:1px solid #222a34; color:#dfe5ec; font-size:14px;
      }

      .list{ display:grid; gap:10px }
      .booking{
        display:grid; gap:10px; grid-template-columns: 1fr auto; align-items:center; padding:12px; background:#12161b; border:1px solid #2a313b; border-radius:12px;
      }
      .booking .title{ font-weight:700 }
      .booking .meta{ color:var(--text-dim); font-size:12px }
      .booking .ops{ display:flex; gap:8px }

      footer{ margin-top:22px; color:var(--text-dim); font-size:12px; text-align:center }
      .kbd{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background:#0f1317; border:1px solid #2a313b; padding:1px 6px; border-radius:6px }
    </style>
  </head>
  <body>
    <div class="app">
      <header>
        <div class="brand">
          <div class="logo" aria-hidden="true">BB</div>
          <div>
            <h1>Barber Booker</h1>
            <small>Prototype • Dark • Mobile‑first</small>
          </div>
        </div>
        <div class="subtle">Today: <span id="todayLabel"></span></div>
      </header>

      <main class="grid">
        <!-- Left: Selection -->
        <section class="card" aria-label="Booking form">
          <div class="section">
            <h2>Choose a service</h2>
            <div class="seg" role="radiogroup" aria-label="Service">
              <label>
                <input type="radio" name="service" value="Haircut|30" checked>
                <div class="chip" tabindex="0"><span>Haircut</span><span class="dur">30m</span></div>
              </label>
              <label>
                <input type="radio" name="service" value="Beard Trim|20">
                <div class="chip" tabindex="0"><span>Beard Trim</span><span class="dur">20m</span></div>
              </label>
              <label>
                <input type="radio" name="service" value="Combo (Hair + Beard)|50">
                <div class="chip" tabindex="0"><span>Combo</span><span class="dur">50m</span></div>
              </label>
              <label>
                <input type="radio" name="service" value="Barber Session|60">
                <div class="chip" tabindex="0"><span>Barber Session</span><span class="dur">60m</span></div>
              </label>
            </div>
          </div>

          <div class="section">
            <h2>Pick a professional</h2>
            <div class="pro-list" role="radiogroup" aria-label="Professional">
              <label class="pro">
                <input type="radio" name="pro" value="Ana" checked>
                <div class="avatar">A</div>
                <div class="meta"><span class="name">Ana</span><span class="role">Fade specialist</span></div>
              </label>
              <label class="pro">
                <input type="radio" name="pro" value="Bruno">
                <div class="avatar">B</div>
                <div class="meta"><span class="name">Bruno</span><span class="role">Classic cuts</span></div>
              </label>
              <label class="pro">
                <input type="radio" name="pro" value="Carlos">
                <div class="avatar">C</div>
                <div class="meta"><span class="name">Carlos</span><span class="role">Beard master</span></div>
              </label>
            </div>
          </div>

          <div class="section">
            <h2>Date & your info</h2>
            <div class="inputs">
              <div class="field">
                <label for="date">Day</label>
                <input id="date" type="date" />
                <div class="subtle">Closed on Sundays</div>
              </div>
              <div class="field">
                <label for="name">Your name</label>
                <input id="name" type="text" placeholder="e.g. Alex Doe" autocomplete="name" />
              </div>
              <div class="field">
                <label for="phone">Phone</label>
                <input id="phone" type="tel" placeholder="e.g. +1 555 123 4567" autocomplete="tel" />
              </div>
              <div class="field">
                <label for="notes">Notes</label>
                <input id="notes" type="text" placeholder="Optional: style ref, etc." />
              </div>
            </div>
          </div>

          <div class="section">
            <h2>Available times</h2>
            <div id="closedMsg" class="closed" hidden>
              We’re closed this day. Please pick a Monday–Saturday.
            </div>
            <div id="slots" class="slots" role="listbox" aria-label="Available time slots"></div>
          </div>

          <div class="section">
            <div class="summary" id="summary"></div>
            <div class="actions">
              <button class="btn" id="bookBtn" disabled>Confirm booking</button>
              <button class="btn secondary" id="clearBtn" type="button">Clear</button>
            </div>
          </div>
        </section>

        <!-- Right: My bookings -->
        <section class="card" aria-label="Your bookings">
          <div class="section">
            <h2>Your bookings</h2>
            <div class="subtle">Saved locally. You can cancel or add to your calendar.</div>
          </div>
          <div class="section">
            <div id="list" class="list"></div>
          </div>
        </section>
      </main>

      <footer>
        Prototype only — no backend. Data persists to your browser storage. Press <span class="kbd">Clear</span> to reset.
      </footer>
    </div>

    <script>
      ;(() => {
        const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
        const $ = (sel, root=document) => root.querySelector(sel);

        // Theme helpers
        const fmt = (n) => n.toString().padStart(2,'0');
        const today = new Date();
        const toISODate = (d) => {
          const z = new Date(d.getTime());
          z.setHours(0,0,0,0);
          return `${z.getFullYear()}-${fmt(z.getMonth()+1)}-${fmt(z.getDate())}`;
        };
        const fromISODate = (s) => { const [y,m,d] = s.split('-').map(Number); return new Date(y, m-1, d); };

        const openDays = [1,2,3,4,5,6]; // Mon..Sat
        const business = { start: 9*60, end: 19*60, step: 30 }; // minutes

        const slotLabel = (min) => {
          const h = Math.floor(min/60), m = min%60; return `${fmt(h)}:${fmt(m)}`;
        };
        const nowMinutes = () => {
          const n = new Date(); return n.getHours()*60 + n.getMinutes();
        };
        const clampToNextStep = (min, step) => Math.ceil(min/step)*step;

        // Storage
        const storeKey = 'barberBookings_v1';
        const load = () => {
          try{ return JSON.parse(localStorage.getItem(storeKey) || '[]'); }catch{ return [] }
        };
        const save = (arr) => localStorage.setItem(storeKey, JSON.stringify(arr));

        let bookings = load();

        // UI Elements
        const els = {
          todayLabel: $('#todayLabel'),
          date: $('#date'), name: $('#name'), phone: $('#phone'), notes: $('#notes'),
          serviceRadios: $$('input[name="service"]'),
          proRadios: $$('input[name="pro"]'),
          slots: $('#slots'),
          closedMsg: $('#closedMsg'),
          summary: $('#summary'),
          bookBtn: $('#bookBtn'),
          clearBtn: $('#clearBtn'),
          list: $('#list')
        };

        // State
        const state = {
          service: { name: 'Haircut', minutes: 30 },
          pro: 'Ana',
          date: toISODate(today),
          slot: null,
        };

        // Initialize
        const init = () => {
          els.todayLabel.textContent = today.toLocaleDateString(undefined, { weekday:'short', year:'numeric', month:'short', day:'numeric' });
          // date limits next 30 days
          const min = toISODate(today);
          const maxDate = new Date(today.getTime() + 30*86400000);
          els.date.min = min; els.date.max = toISODate(maxDate); els.date.value = state.date;

          // wire service
          els.serviceRadios.forEach(r => r.addEventListener('change', () => {
            const [name, minutes] = r.value.split('|');
            if(r.checked){ state.service = { name, minutes: Number(minutes) }; state.slot = null; renderSlots(); renderSummary(); }
          }));

          // wire pros
          els.proRadios.forEach(r => r.addEventListener('change', () => { if(r.checked){ state.pro = r.value; state.slot = null; renderSlots(); renderSummary(); }}));

          // wire date
          els.date.addEventListener('change', () => { state.date = els.date.value; state.slot = null; renderSlots(); renderSummary(); });

          // actions
          els.bookBtn.addEventListener('click', onBook);
          els.clearBtn.addEventListener('click', onClear);

          renderSlots();
          renderSummary();
          renderList();
        };

        function dayOpen(d){
          const dow = d.getDay(); // 0 Sun
          return openDays.includes(dow);
        }

        function computeBlockedForDay(pro, dateISO){
          // Map of minute -> blocked true
          const blocked = new Set();
          const dayBookings = bookings.filter(b => b.pro === pro && b.date === dateISO);
          for(const b of dayBookings){
            const start = b.start; const end = b.end; // minutes
            for(let t=start; t<end; t+= business.step){ blocked.add(t); }
          }
          return blocked;
        }

        function serviceSlotsNeeded(min){
          // round up to step
          return Math.max(1, Math.ceil(min / business.step));
        }

        function renderSlots(){
          els.slots.innerHTML = '';
          const d = fromISODate(state.date);
          const isOpen = dayOpen(d);
          els.closedMsg.hidden = isOpen;
          if(!isOpen){ els.bookBtn.disabled = true; return; }

          const blocked = computeBlockedForDay(state.pro, state.date);
          const slotsNeeded = serviceSlotsNeeded(state.service.minutes);
          const nowMin = toISODate(today) === state.date ? nowMinutes() : -1;
          let startMin = business.start;
          if(nowMin >= 0){ startMin = Math.max(business.start, clampToNextStep(nowMin, business.step)); }

          const endMin = business.end - (slotsNeeded-1)*business.step; // last start that fits service

          const frag = document.createDocumentFragment();
          const makeBtn = (t) => {
            const btn = document.createElement('button');
            btn.type = 'button'; btn.className = 'slot'; btn.textContent = slotLabel(t);
            btn.setAttribute('role','option'); btn.dataset.t = String(t);
            // availability check: all segment slots must be free
            let free = true;
            for(let k=0;k<slotsNeeded;k++){
              if(blocked.has(t + k*business.step)){ free = false; break; }
            }
            if(t < startMin || t > endMin){ free = false; }
            if(!free) btn.disabled = true;
            if(state.slot === t){ btn.classList.add('selected'); }
            btn.addEventListener('click', () => {
              if(btn.disabled) return;
              state.slot = t; renderSlots(); renderSummary();
            });
            return btn;
          };

          for(let t = business.start; t <= business.end - business.step; t += business.step){
            frag.appendChild(makeBtn(t));
          }
          els.slots.appendChild(frag);
        }

        function renderSummary(){
          const lines = [];
          lines.push(`Service: ${state.service.name} (${state.service.minutes}m)`);
          lines.push(`Pro: ${state.pro}`);
          const day = fromISODate(state.date).toLocaleDateString(undefined, { weekday:'short', year:'numeric', month:'short', day:'numeric' });
          lines.push(`Day: ${day}`);
          if(state.slot != null){
            const startL = slotLabel(state.slot);
            const endL = slotLabel(state.slot + serviceSlotsNeeded(state.service.minutes)*business.step);
            lines.push(`Time: ${startL} – ${endL}`);
          } else {
            lines.push('Time: —');
          }
          const hasBasics = els.name.value.trim() && els.phone.value.trim();
          els.bookBtn.disabled = !(hasBasics && state.slot != null && dayOpen(fromISODate(state.date)));
          els.summary.innerHTML = lines.map(x => `<div>${x}</div>`).join('');
        }

        function onBook(){
          const name = els.name.value.trim();
          const phone = els.phone.value.trim();
          if(!name || !phone || state.slot == null){ return; }
          const slotsNeeded = serviceSlotsNeeded(state.service.minutes);
          const start = state.slot; const end = start + slotsNeeded*business.step;
          // double-check availability
          const blocked = computeBlockedForDay(state.pro, state.date);
          for(let k=0;k<slotsNeeded;k++){
            if(blocked.has(start + k*business.step)){
              alert('Sorry, the slot just became unavailable. Please pick another time.');
              renderSlots(); renderSummary();
              return;
            }
          }
          const id = Math.random().toString(36).slice(2);
          const booking = {
            id, name, phone, notes: els.notes.value.trim(),
            service: state.service.name, minutes: state.service.minutes,
            pro: state.pro, date: state.date, start, end,
            createdAt: new Date().toISOString()
          };
          bookings.push(booking); save(bookings);
          // UI updates
          state.slot = null; renderSlots(); renderSummary(); renderList();
          // offer ICS
          const ics = buildICS(booking);
          const a = document.createElement('a');
          a.href = URL.createObjectURL(new Blob([ics], {type:'text/calendar'}));
          a.download = `booking-${booking.date}-${slotLabel(start).replace(':','')}.ics`;
          setTimeout(() => a.click(), 0);
        }

        function onClear(){
          if(confirm('Clear all input and selections?')){
            els.name.value = ''; els.phone.value = ''; els.notes.value='';
            state.slot = null; renderSlots(); renderSummary();
          }
        }

        function renderList(){
          if(!bookings.length){ els.list.innerHTML = '<div class="subtle">No bookings yet.</div>'; return; }
          const frag = document.createDocumentFragment();
          for(const b of bookings.slice().sort((a,b)=> (a.date.localeCompare(b.date) || a.start-b.start))){
            const el = document.createElement('div'); el.className = 'booking';
            const when = `${fromISODate(b.date).toLocaleDateString(undefined,{weekday:'short', month:'short', day:'numeric'})} · ${slotLabel(b.start)}–${slotLabel(b.end)}`;
            el.innerHTML = `
              <div>
                <div class="title">${b.service} with ${b.pro}</div>
                <div class="meta">${when} • ${b.minutes}m • ${b.name} (${b.phone})${b.notes? ' • '+escapeHtml(b.notes): ''}</div>
              </div>
              <div class="ops">
                <button class="btn ghost" data-op="ics">Add to calendar</button>
                <button class="btn danger" data-op="cancel">Cancel</button>
              </div>
            `;
            el.querySelector('[data-op="cancel"]').addEventListener('click', () => {
              if(confirm('Cancel this booking?')){
                bookings = bookings.filter(x => x.id !== b.id); save(bookings); renderSlots(); renderList();
              }
            });
            el.querySelector('[data-op="ics"]').addEventListener('click', () => {
              const ics = buildICS(b);
              const a = document.createElement('a');
              a.href = URL.createObjectURL(new Blob([ics], {type:'text/calendar'}));
              a.download = `booking-${b.date}-${slotLabel(b.start).replace(':','')}.ics`;
              a.click();
            });
            frag.appendChild(el);
          }
          els.list.innerHTML = ''; els.list.appendChild(frag);
        }

        function buildICS(b){
          // Simplified ICS event
          const dt = (dateISO, minutes) => {
            const d = fromISODate(dateISO);
            const h = Math.floor(minutes/60), m = minutes%60;
            d.setHours(Math.floor(minutes/60), minutes%60, 0, 0);
            const y = d.getFullYear();
            const mo = fmt(d.getMonth()+1); const da = fmt(d.getDate());
            const hh = fmt(d.getHours()); const mm = fmt(d.getMinutes());
            return `${y}${mo}${da}T${hh}${mm}00`;
          };
          const uid = `${b.id}@barber-booker`;
          const lines = [
            'BEGIN:VCALENDAR',
            'VERSION:2.0',
            'PRODID:-//Barber Booker//EN',
            'CALSCALE:GREGORIAN',
            'METHOD:PUBLISH',
            'BEGIN:VEVENT',
            `UID:${uid}`,
            `DTSTAMP:${new Date().toISOString().replace(/[-:]/g,'').replace(/\..+/,'Z')}`,
            `DTSTART:${dt(b.date, b.start)}`,
            `DTEND:${dt(b.date, b.end)}`,
            `SUMMARY:${escapeICS(b.service)} with ${escapeICS(b.pro)}`,
            `DESCRIPTION:${escapeICS(`Client: ${b.name} (${b.phone})${b.notes? '\nNotes: '+b.notes: ''}`)}`,
            'END:VEVENT',
            'END:VCALENDAR'
          ];
          return lines.join('\r\n');
        }

        function escapeHtml(s){
          return s.replace(/[&<>\"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
        }
        function escapeICS(s){
          return String(s).replace(/\\/g,'\\\\').replace(/\n/g,'\\n').replace(/,|;/g, m => '\\'+m);
        }

        // Listen to input changes to reflect summary
        ['input','change'].forEach(evt => {
          els.name.addEventListener(evt, renderSummary);
          els.phone.addEventListener(evt, renderSummary);
          els.notes.addEventListener(evt, renderSummary);
        });

        // Make chips keyboard-usable
        $$('.seg .chip').forEach(ch => {
          ch.addEventListener('keydown', (e) => {
            if(e.key === ' ' || e.key === 'Enter'){
              e.preventDefault();
              const input = ch.previousElementSibling; input.checked = true; input.dispatchEvent(new Event('change'));
            }
          })
        })

        init();
      })();
    </script>
  </body>
  </html>
